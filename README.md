<h1>writers-app</h1>

<h2>Задание</h2>

Реализовать сервис, который хранит в PostgreSQL данные о писателях и их книгах, и способен по HTTP-запросу <b>GET /writers/&lt;writer_id></b> возвращать информацию о писателе и его книгах в формате JSON.

<h2>Требования</h2>

<ol>
    <li>Сервис должен иметь поддержку запуска из консоли с параметром командной строки <i>init</i>, который создает в базе данных нужные таблицы, и заполняет их тестовыми данными (пара-тройка писателей и их книг).</li>
    <li>Метод получения данных о писателе по HTTP-запросу <u>не должен обращаться к базе данных более одного раза</u>.</li>
    <li>Наличие которого README.md с инструкцией по инициализации базы данных и по запуску сервиса.</li>
</ol>

<h2>Модели данных</h2>

<h3>Писатели (writers)</h3>

<table>
    <tr>
        <td>id</td>
        <td>идентификатор</td>
    </tr>
    <tr>
        <td>name</td>
        <td>имя</td>
    </tr>
</table>

<h3>Книги (books)</h3>

<table>
    <tr>
        <td>id</td>
        <td>идентификатор</td>
    </tr>
    <tr>
        <td>author_id</td>
        <td>идентификатор автора</td>
    </tr>
    <tr>
        <td>title</td>
        <td>название</td>
    </tr>
</table>

<h2>Реализация</h2>

Разработанный сервис реализован на основе трехзвенной архитектуры и включает в себя следующие составляющие:
<ol>
    <li>Клиент (<i>writers.py</i>)</li>
    <li>Сервер (<i>app.py</i>)</li>
    <li>База данных (<i>writers</i>)</li>
</ol>

<h2>Развертывание</h2>

Для развертывания базы данных и сервера воспользуйтесь следующей инструкцией:
<ol>
    <li>Создайте базу данных <i>writers</i>. В терминале Linux вы можете сделать это посредством применения следующих команд:
        <ul>
            <li><i>sudo -i -u &lt;username></i>, где <i>username</i> - имя пользователя (по умолчанию <i>postgres</i>).</li>
            <li><i>createdb writers</i></li>
        </ul>
    </li>
    <li>В папке с сервером создайте файл переменных окружения .env (<i>touch .env</i>). В созданном файле создайте переменную <i>DATABASE_URL</i>, имеющую в качестве своего значения ссылку на базу данных. (По умолчанию для локальной сети <i>DATABASE_URL=postgresql://postgres:postgres@localhost/writers</i>)</li>
    <li>Установите необходимые зависимости (<i>pip install -r requirements.txt</i>) для сервера.</li>
    <li>Запустите серверное приложение (<i>python3 app.py</i>).</li>
</ol>

<h2>Использование</h2>

Для использование сервиса выполните следующие шаги:
<ol>
    <li>Перед первым запуском клиентского приложения в папке с приложением создайте файл переменных окружения .env (<i>touch .env</i>). В созданном файле создайте переменную <i>HOST_URL</i>, имеющую в качестве своего значения ссылку на сервер. (По умолчанию для локальной сети <i>HOST_URL=http://localhost:5000</i>)</li>
    <li>Запустите клиентское приложение (<i>python3 writers.py</i>) с одним из следующих параметров командной строки:
        <ul>
            <li><i>-i (--init)</i> - для создания необходимых таблиц в базе данных.</li>
            <li><i>-s (--show)</i> - для получения данных об идентификаторах писателей.</li>
            <li><i>-w (--writer) &lt;writer_id></i> - для получения данных о выбранном писателе по его идентификатору.</li>
        </ul>
    </li>
</ol>

<h2>Пример использования программы</h2>

1. Создание таблиц (<i>python3 writers.py -i</i>):

> Tables 'writers' and 'books' has been initialized.

2. Получение данных об идентификаторах писателей (<i>python3 writers.py -s</i>):


```json
[
    {
        "id": 1,
        "name": "Достоевский, Ф.М."
    },
    {
        "id": 2,
        "name": "Булгаков, М.А."
    },
    {
        "id": 3,
        "name": "Куприн, А.И."
    }
]
```

3. Получение данных о трудах Достоевского (<i>python3 writers.py -w 1</i>):

```json
{
    "id": 1,
    "name": "Достоевский, Ф.М.",
    "books": [
        {
            "id": 2,
            "title": "Преступление и наказание"
        },
        {
            "id": 3,
            "title": "Игрок"
        },
        {
            "id": 7,
            "title": "Братья Карамазовы"
        },
        {
            "id": 8,
            "title": "Идиот"
        }
    ]
}
```

